{"ast":null,"code":"import{Component}from'react';import Spinner from'../spinner/Spinner';import ErrorMessage from'../error/ErrorMessage';import'./charList.scss';import MarvelService from'../services/MarvelService';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";class CharList extends Component{constructor(){super(...arguments);this.state={charList:[],loading:true,error:false,newItemLoading:false,offset:205,charEnded:false};this.marvelService=new MarvelService();this.onRequest=offset=>{this.onCharListLoading();this.marvelService.getAllCharacters(offset).then(this.onCharListLoaded).catch(this.onError);};this.onCharListLoading=()=>{this.setState({newItemLoading:true});};this.onCharListLoaded=newCharList=>{let ended=false;if(newCharList.length<9){ended=true;}this.setState(_ref=>{let{charList,offset}=_ref;return{charList:[...charList,...newCharList],loading:false,newItemLoading:false,offset:offset+9,charEnded:ended};});};this.onError=()=>{this.setState({error:true,loading:false});};this.items=[];this.setMyRef=elem=>{this.items.push(elem);};this.onFocusElem=id=>{this.items.forEach(item=>item.classList.remove('char__item_selected'));this.items[id].classList.add('char__item_selected');};}componentDidMount(){this.marvelService.getAllCharacters().then(this.onCharListLoaded).catch(this.onError);}renderItems(arr){const items=arr.map((item,i)=>{let imgStyle={'objectFit':'cover'};if(item.thumbnail==='http://i.annihil.us/u/prod/marvel/i/mg/b/40/image_not_available.jpg'){imgStyle={'objectFit':'unset'};}return/*#__PURE__*/_jsxs(\"li\",{tabIndex:0,ref:this.setMyRef,className:\"char__item\",onClick:()=>{this.props.onCharSelected(item.id);this.onFocusElem(i);},children:[/*#__PURE__*/_jsx(\"img\",{src:item.thumbnail,alt:item.name,style:imgStyle}),/*#__PURE__*/_jsx(\"div\",{className:\"char__name\",children:item.name})]},item.id);});return/*#__PURE__*/_jsx(\"ul\",{className:\"char__grid\",children:items});}render(){const{charList,loading,error,newItemLoading,offset,charEnded}=this.state;const items=this.renderItems(charList);const errorMessage=error?/*#__PURE__*/_jsx(ErrorMessage,{}):null;const spinner=loading?/*#__PURE__*/_jsx(Spinner,{}):null;const content=!(loading||error)?items:null;return/*#__PURE__*/_jsxs(\"div\",{className:\"char__list\",children:[errorMessage,spinner,content,/*#__PURE__*/_jsx(\"button\",{className:\"button button__main button__long\",disabled:newItemLoading,style:{'display':charEnded?'none':'block'},onClick:()=>this.onRequest(offset),children:/*#__PURE__*/_jsx(\"div\",{className:\"inner\",children:\"load more\"})})]});}}export default CharList;","map":{"version":3,"names":["Component","Spinner","ErrorMessage","MarvelService","jsx","_jsx","jsxs","_jsxs","CharList","constructor","arguments","state","charList","loading","error","newItemLoading","offset","charEnded","marvelService","onRequest","onCharListLoading","getAllCharacters","then","onCharListLoaded","catch","onError","setState","newCharList","ended","length","_ref","items","setMyRef","elem","push","onFocusElem","id","forEach","item","classList","remove","add","componentDidMount","renderItems","arr","map","i","imgStyle","thumbnail","tabIndex","ref","className","onClick","props","onCharSelected","children","src","alt","name","style","render","errorMessage","spinner","content","disabled"],"sources":["/Users/michaelkozyutenko/Desktop/ITmacbook/Learning/JS+react theory/JS+react course/react course abstracts/Средний react/marvel_practice/src/components/charList/CharList.js"],"sourcesContent":["import { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nimport Spinner from '../spinner/Spinner';\nimport ErrorMessage from '../error/ErrorMessage'\n\nimport './charList.scss';\nimport MarvelService from '../services/MarvelService';\n\nclass CharList extends Component {\n    state = {\n        charList: [], \n        loading: true, \n        error: false,\n        newItemLoading: false, \n        offset: 205, \n        charEnded: false \n    }\n    \n    marvelService = new MarvelService();\n\n    componentDidMount() { \n        this.marvelService.getAllCharacters() \n            .then(this.onCharListLoaded)\n            .catch(this.onError)\n    }\n\n    onRequest = (offset) => { \n        this.onCharListLoading(); \n        this.marvelService.getAllCharacters(offset) \n            .then(this.onCharListLoaded)\n            .catch(this.onError)\n    }\n\n    onCharListLoading = () => {\n        this.setState({ \n            newItemLoading: true\n        })\n    }\n\n\n    onCharListLoaded = (newCharList) => { \n        let ended = false; \n        if (newCharList.length < 9) { \n            ended = true; \n        }\n\n        this.setState(({charList, offset}) => ({ \n            charList: [...charList, ...newCharList], \n            loading: false,\n            newItemLoading: false, \n            offset: offset + 9, \n            charEnded: ended \n        }))\n    }\n\n    onError = () => {\n        this.setState({\n            error: true,\n            loading: false\n        })\n    }\n    \n    items = [];\n\n    setMyRef = (elem) => {\n        this.items.push(elem); \n    }\n\n    onFocusElem = (id) => { \n        this.items.forEach(item => item.classList.remove('char__item_selected')); \n        this.items[id].classList.add('char__item_selected'); \n    }\n\n    renderItems(arr) {\n        const items = arr.map((item, i) => { \n            let imgStyle = {'objectFit': 'cover'};\n            if (item.thumbnail === 'http://i.annihil.us/u/prod/marvel/i/mg/b/40/image_not_available.jpg') {\n                imgStyle = {'objectFit': 'unset'}; \n            }\n\n            return (\n                <li \n                    tabIndex={0} \n                    ref={this.setMyRef} \n                    className='char__item'\n                    key={item.id}\n                    onClick={() => { \n                            this.props.onCharSelected(item.id);\n                            this.onFocusElem(i); \n                        }}\n                        > \n                        <img src={item.thumbnail} alt={item.name} style={imgStyle}/>\n                        <div className=\"char__name\">{item.name}</div>\n                </li>\n            )\n        });\n        \n        return (\n            <ul className=\"char__grid\">\n                {items}\n            </ul>\n        )\n    }\n\n    render() {\n        const {charList, loading, error, newItemLoading, offset, charEnded} = this.state;\n        \n        const items = this.renderItems(charList); \n\n        const errorMessage = error ? <ErrorMessage/> : null;\n        const spinner = loading ? <Spinner/> : null;\n        const content = !(loading || error) ? items : null;\n        \n        return (\n            <div className=\"char__list\">\n                {errorMessage}\n                {spinner}\n                {content}\n                <button \n                    className=\"button button__main button__long\"\n                    disabled={newItemLoading} \n                    style={{'display': charEnded ? 'none' : 'block'}} \n                    onClick={() => this.onRequest(offset)} \n                    > \n                    <div className=\"inner\">load more</div>\n                </button>\n            </div>\n        )\n    }\n}\n\nCharList.propTypes = {\n    onCharSelected: PropTypes.func.isRequired\n}\n\nexport default CharList;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}